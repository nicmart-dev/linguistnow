# Development Principles

## Core Principles

1. **API First**: Define types, interfaces, and API contracts before implementation
2. **TDD (Test Driven Development)**: Write failing tests first, then implement to make them pass
3. **DRY (Don't Repeat Yourself)**: Extract reusable code into shared modules
4. **Modular**: Keep services, controllers, and utilities in separate files
5. **Docs as Code**: Update documentation alongside implementation, not as an afterthought

## Development Workflow

1. Define types in `shared/` package (API contract)
2. Write failing tests (TDD red phase)
3. Implement to make tests pass (TDD green phase)
4. Refactor if needed (TDD refactor phase)
5. Update docs and Swagger alongside code changes

## Code Organization

- `shared/src/` - Types shared between client and server
- `server/services/` - Business logic (testable, reusable)
- `server/controllers/` - HTTP request/response handling
- `server/routes/` - Route definitions with Swagger docs
- `client/src/components/` - React components
- `client/src/i18n/locales/` - Internationalization strings (all user-facing text)
- `docs/` - Architecture and integration documentation

## Internationalization (i18n)

- **All user-facing strings must be externalized** to `client/src/i18n/locales/*.json`
- **When adding new strings, translate them in ALL locale files** (en, fr, es, de, it, pt, zh-cn, ja, ko, ar, ru)
- Server error codes (e.g., `VAULT_ERROR`, `TOKEN_EXPIRED`) should map to i18n keys in the client
- Use the pattern `section.subsection.key` (e.g., `dashboard.errors.vaultError`)
- Support pluralization with `_one` and `_other` suffixes
- Interpolate dynamic values using `{{variable}}` syntax

---

# Commit Message Guidelines

Follow Conventional Commits specification: https://www.conventionalcommits.org/

## Format

```
<type>(<scope>): <description>

[optional body]

[optional footer(s)]
```

## CRITICAL: User-Facing vs Internal Changes

This project uses **semantic-release** for automatic versioning. The commit type determines:
1. Whether a release is triggered
2. Whether the change appears in the changelog

### üöÄ RELEASE-TRIGGERING Types (User-Facing Changes)

Use these ONLY for changes that affect end users:

| Type | When to Use | Release |
|------|-------------|---------|
| `feat` | New user-facing functionality | Minor (1.x.0) |
| `fix` | Bug fix that users can observe | Patch (1.0.x) |
| `perf` | Performance improvement users can notice | Patch (1.0.x) |

**‚ö†Ô∏è IMPORTANT:** 
- `fix` is ONLY for bugs that users experience, NOT for internal/CI/build issues
- `feat` is ONLY for features users interact with, NOT for developer tooling

### üîß NON-RELEASE Types (Internal Changes)

Use these for internal/developer-facing changes:

| Type | When to Use | Release |
|------|-------------|---------|
| `ci` | CI/CD pipeline changes (GitHub Actions, workflows) | None |
| `build` | Build system, dependencies, Docker | None |
| `chore` | Maintenance tasks, config updates | None |
| `docs` | Documentation changes | None |
| `refactor` | Code restructuring without behavior change | None |
| `style` | Formatting, whitespace, semicolons | None |
| `test` | Adding or updating tests | None |
| `revert` | Reverting a previous commit | Depends |

## Decision Guide: Which Type to Use?

Ask yourself: **"Will a user notice this change?"**

```
Is this a CI/GitHub Actions change?
  ‚Üí YES: Use `ci:` (not `fix(ci):`)
  
Is this a build/Docker/dependency change?  
  ‚Üí YES: Use `build:` (not `fix(build):`)
  
Is this fixing something users experience?
  ‚Üí YES: Use `fix:` ‚úÖ
  ‚Üí NO: Use the appropriate non-release type

Is this a new feature users will use?
  ‚Üí YES: Use `feat:` ‚úÖ
  ‚Üí NO: Use the appropriate non-release type
```

## Examples

### ‚úÖ CORRECT Usage

```bash
# User-facing bug fix ‚Üí triggers patch release
fix(client): prevent crash when calendar is empty

# User-facing feature ‚Üí triggers minor release  
feat(server): add calendar export endpoint

# CI change ‚Üí NO release
ci: add Node.js 22 to test matrix

# Build/Docker change ‚Üí NO release
build(docker): optimize multi-stage build

# Workflow fix ‚Üí NO release (it's CI, not user-facing)
ci: fix release workflow permissions

# Dependency update ‚Üí NO release
build(deps): upgrade express to 5.0

# Internal refactor ‚Üí NO release
refactor(server): extract auth logic to service

# Documentation ‚Üí NO release
docs: update API documentation
```

### ‚ùå INCORRECT Usage (Avoid These)

```bash
# WRONG: CI issues should use `ci:`, not `fix(ci):`
fix(ci): update Node.js version  
# CORRECT: ci: update Node.js to v22

# WRONG: Build issues should use `build:`, not `fix(build):`
fix(build): resolve Docker build error
# CORRECT: build(docker): resolve multi-stage build error

# WRONG: Internal tooling is not a user feature
feat(ci): add semantic-release
# CORRECT: ci: add semantic-release for versioning

# WRONG: Dependency updates are not bug fixes
fix(deps): update lodash
# CORRECT: build(deps): update lodash to 4.17.21

# WRONG: Refactoring is not a feature
feat(server): reorganize file structure
# CORRECT: refactor(server): reorganize file structure
```

## Scopes

Use scopes to indicate the affected area:

| Scope | Description |
|-------|-------------|
| `client` | Frontend React application |
| `server` | Backend Express API |
| `shared` | Shared types package |
| `docker` | Docker configuration |
| `deps` | Production dependencies |
| `deps-dev` | Development dependencies |

**Note:** For `ci:`, `build:`, `docs:` types, scope is often optional since the type itself is descriptive.

## Breaking Changes

For breaking changes, add `!` after the type or include `BREAKING CHANGE:` in the footer:

```bash
feat(server)!: remove deprecated /api/v1 endpoints

# or

feat(server): migrate to new authentication system

BREAKING CHANGE: OAuth tokens now use JWT format. 
Clients must update their token handling.
```

## Quick Reference

| Change | Correct Type | Triggers Release? |
|--------|--------------|-------------------|
| Fix user-visible bug | `fix:` | ‚úÖ Patch |
| Add user feature | `feat:` | ‚úÖ Minor |
| Performance boost | `perf:` | ‚úÖ Patch |
| Fix CI workflow | `ci:` | ‚ùå No |
| Fix Docker build | `build:` | ‚ùå No |
| Update dependency | `build(deps):` | ‚ùå No |
| Refactor code | `refactor:` | ‚ùå No |
| Update docs | `docs:` | ‚ùå No |
| Add tests | `test:` | ‚ùå No |
| Config changes | `chore:` | ‚ùå No |
